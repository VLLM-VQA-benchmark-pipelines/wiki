---
Author:
  - Ширяев Антон
tags:
  - dataset
date:
---

Создать один датасет подходящий сразу для всех задач ([ссылка](Задачи%20от%20бизнеса.md)) кажется сложным.
Мы решили, что можно создать два вида датасетов, формат которых позволит решать сразу по 2 задачи.
# Датасет 1. Определение класса документа и извлечение информации из него

**Для задач:**
- Классификация документов по типам (1)    
- Извлечение нужной информации из документа (1.1)    
## Структура датасета

**Вход для визуального энкодера:**
* одна картинка image (скан документа)
* набор картинок images (сканы страниц для многостраничного документа)

**Вход для текстового энкодера:**
* произвольное количество вопросов на каждый image/images

**Правильный ответ:**
* по одному или нескольким правильным ответам на каждый заданный вопрос

**Дополнительные параметры:**
* класс документа (паспорт, накладная и т.д.)

Позволит решать задачу классификации документов.
* тип вопроса (возможно) (ФИО, сумма по счетам и т.д.)

Позволит оценивать метрики для разных типов вопросов.
Было предложение от Марка.

* Детекционный bbox внутри которого есть правильный текст-ответ на вопрос.
В целом моделям VLLM bbox не нужен. Но они могут его предсказывать, и по метрикам по bbox мы сможет оценить, а там ли модель ищет правильный ответ.
Проверить отдает ли VLLM детекционный bbox с правильный ответом по документу.

## Потенциальная реализация

Запуск бенчмарка:
- Запустить бенчмарк с парой датасетов на которых он умеет работать какой то из моделей которые он поддерживает.   
- Запустить маленьком кусочке датасета (из 20 картинок и вопросов по ним)    

Поиск подходящего формата датасета:
- Посмотрим готовые бенчмарки    
- Посмотреть форматы датасетов которые они поддерживает    
- Поискать среди этих форматов наиболее подходящие под нашу задачу    
- Если такой формат найден то используем его!    

Поиск способа добавления нашего формата датасета:
- Если не найден, то делаем свой кастомный.    
- Надо понять какой класс написать для того, чтобы этот бенчмарк смог работать с датасетом нашего формата.    

Какие метрики поддерживает данный бенчмарк?
- Посмотреть какие метрики поддерживаются    
- Есть ли полезные для наших задач    

Запуск наших моделей на бенчмарке:
- Смотрим какие поддерживаются и тестируем их на мини кусочках датасета(убеждаемся что все работает)    
- Ищем способ как добавить свою новую модель в данный бенчмарк. Есть какой то класс, описывающий предикт моделью на картинке при заданном вопросе.    
- Реализуем свой класс поддерживающий каждую из моделей. 

Можно модифицировать формат датасета DocVQA.
Изначально у него структура CSV-файла с полями ([ссылка](https://gist.github.com/NSTiwari/04257efebf61a58cdf5e0e136a8e4f6c)): 

| id      | query                                 | answers         |
| ------- | ------------------------------------- | --------------- |
| train_0 | What is the DEXTROSE (GLUCOSE) level? | "['42', '42%']" |

- **id** - id картинка-скан документа    
- **query** - вопрос по картинке    
- **answers** - массив-строк правильных ответов на вопрос.  

Учитывая наш запрос можно сделать так

| images names                   | question      | answers                  | doc class | question<br><br>type | answear bbox    |
| ------------------------------ | ------------- | ------------------------ | --------- | -------------------- | --------------- |
| “[‘image1.jpg’]”               | Текст вопроса | "['Ответ 1', 'Ответ 2']" | passport  | ФИО                  | “[10,20,30,40]” |
| “[‘image2.jpg’, ‘image3.jpg’]” | Текст вопроса | "['Ответ 1'']"           | document  | Сумма                | “[10,20,30,40]” |
| “[‘image4.jpg’]”               | Текст вопроса | “path\to\json”           | document  | json                 | ?               |

### Окончательный формат

| image_path  | question        | answer         | doc class | question<br><br>type | answear bbox    |
| ----------- | --------------- | -------------- | --------- | -------------------- | --------------- |
| /image1.jpg | "Текст вопроса" | "Текст ответа" | passport  | "Имя"                | “[10,20,30,40]” |
| /image1.jpg | "Текст вопроса" | "Текст ответа" | passport  | "Фамилия"            | “[10,20,30,40]” |
| /image3.jpg | "Текст вопроса" | “Текст ответа” | document  | "Сумма"              | “[10,20,30,40]" |
### Плюсы:
- это просто папка с картинками ./images и csv-файл    
- не нужно специального ПО для разметки, подходит ПО электронных таблиц    
- можно легко разделить документ между несколькими разметчиками и потом объединить таблицы по рядам    
- наглядное представление, которое легко читать глазами. Специального ПО не требуется.    
- Считывается и обрабатывается в pandas.   
### Минусы:
- Разметчик может запутаться в двойных и одинарных кавычках в полях (“images names”, “answers”)    
- answers может быть путем к json или массивом строк… 
### Мысли:
- можно сделать поле “true order” и указывать для многостраничных документов правильный порядок.

# Датасет 2. Определение порядка страниц в многостраничном документе

**Для задач:**
- Классификация документов по типам (1)    
- Определения порядка страниц многостраничного документа (3.1, 3.2)  
## Структура датасета

Вход для визуального энкодера:
* набор картинок images (сканы страниц для многостраничного документа)

**Вход для текстового энкодера:**
* Один промпт по определению правильного порядка страниц

**Правильный ответ:**
* правильный порядок страниц

**Дополнительные параметры:**
* класс документа (паспорт, накладная и т.д.)

Позволит решать задачу классификации документов.

## Потенциальная реализация 

| images names                                | true order  | doc class |
| ------------------------------------------- | ----------- | --------- |
| “[‘image3.jpg’, ‘image2.jpg’, ‘image1.jpg]” | “[3, 2, 1]” | document  |
| “[‘image2.jpg’, ‘image3.jpg’, ‘image1.jpg]” | “[2, 3, 1]” | document  |

Все возможные перестановки страниц между собой.
Вопрос: Включаем ли правильную? =) 

### Плюсы:
- это просто папка с картинками ./images и csv-файл    
- не нужно специального ПО для разметки, подходит ПО электронных таблиц    
- можно легко разделить документ между несколькими разметчиками и потом объединить таблицы по рядам    
- наглядное представление, которое легко читать глазами. Специального ПО не требуется.    
- Считывается и обрабатывается в pandas.    

### Минусы:
- Разметчик может запутаться в двойных и одинарных кавычках в полях (“images names”, “answers”)    
- answers может быть путем к json или массивом строк…  

# Два датасета:

- с документами где есть номера страниц    
- с документами где нет номеров страниц (возможно затертыми)   